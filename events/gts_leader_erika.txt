namespace = gts_erika

# 绘里香
country_event = {
	#创建绘里香星系
	id = gts_erika.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_system_within_border = {
			spawn_system = {
				min_distance >= 10
				max_distance <= 30
				max_jumps = 1
				initializer = gts_erika_system
				effect = {
					save_event_target_as = gts_bruh_get_erika_system_location
				}
			}
		}
	}
}

country_event = {
	#初次
	id = gts_erika.1000
	title = gts_erika.1000.name
	desc = gts_erika.1000.desc
	picture = GFX_gts_erika_7
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = gts_erika.1000.a
	}
}

fleet_event = {
	#阶段1
	id = gts_erika.1001
	title = gts_erika.1001.name
	desc = gts_erika.1001.desc
	picture = GFX_gts_erika_7
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = {
			set_site_progress_locked = yes
		}
	}
	after = {
		from = {
			set_site_progress_locked = no
		}
	}
	option = {
		name = gts_erika.1001.a
		owner = {
			add_resource = {
				minor_artifacts = 10
			}
		}
	}
}

fleet_event = {
	#阶段2
	id = gts_erika.1002
	title = gts_erika.1002.name
	desc = gts_erika.1002.desc
	picture = GFX_gts_erika_3
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = {
			set_site_progress_locked = yes
		}
	}
	after = {
		from = {
			set_site_progress_locked = no
		}
	}
	option = {
		name = gts_erika.1002.a
		owner = {
			add_resource = {
				minor_artifacts = 10
			}
		}
	}
	option = {
		name = gts_erika.1002.b
		trigger = {
			owner = {
				has_country_flag = gts_flag
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
	}
}

fleet_event = {
	#阶段3
	id = gts_erika.1003
	title = gts_erika.1003.name
	desc = gts_erika.1003.desc
	picture = GFX_gts_erika_5
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = {
			set_site_progress_locked = yes
		}
	}
	after = {
		from = {
			set_site_progress_locked = no
		}
	}
	option = {
		name = gts_erika.1003.a
		trigger = {
			owner = {
				has_country_flag = gts_flag
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
		}
	}
	option = {
		name = gts_erika.1003.b
		trigger = {
			owner = {
				has_country_flag = gts_flag
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
		}
	}
	option = {
		name = gts_erika.1003.c
		owner = {
			add_resource = {
				minor_artifacts = 10
			}
		}
	}
}

fleet_event = {
	#阶段4
	id = gts_erika.1004
	title = gts_erika.1004.name
	desc = gts_erika.1004.desc
	picture = GFX_gts_erika_4
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = {
			set_site_progress_locked = yes
		}
	}
	after = {
		from = {
			set_site_progress_locked = no
		}
	}
	option = {
		name = gts_erika.1004.a
		owner = {
			add_resource = {
				minor_artifacts = 10
			}
		}
	}
	option = {
		name = gts_erika.1004.b
		trigger = {
			owner = {
				has_country_flag = gts_flag
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier4unityreward
				min = @tier4unitymin
				max = @tier4unitymax
			}
		}
	}
}

fleet_event = {
	#阶段5
	id = gts_erika.1005
	title = gts_erika.1005.name
	desc = gts_erika.1005.desc
	picture = GFX_gts_erika_6
	show_sound = event_dig_site
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = {
			set_site_progress_locked = yes
		}
	}
	after = {
		from = {
			set_site_progress_locked = no
		}
	}
	option = {
		name = gts_erika.1005.a
		owner = {
			hidden_effect = {
				country_event = {
					id = gts_erika.1010
					days = 3
				}
			}
		}
	}
	option = {
		name = gts_erika.1005.b
		owner = {
			hidden_effect = {
				country_event = {
					id = gts_erika.1011
					days = 3
				}
			}
		}
	}
}

country_event = {
	# 绘里香a
	id = gts_erika.1010
	title = gts_erika.1010.name
	desc = gts_erika.1010.desc
	picture = GFX_gts_erika_1
	show_sound = event_default
	is_triggered_only = yes
	option = {
		name = gts_erika.1010.a
		hidden_effect = {
			country_event = {
				id = gts_erika.999
			}
		}
	}
}

country_event = {
	# 绘里香b
	id = gts_erika.1011
	title = gts_erika.1011.name
	desc = gts_erika.1011.desc
	picture = GFX_gts_erika_2
	show_sound = event_default
	is_triggered_only = yes
	option = {
		name = gts_erika.1011.a
		hidden_effect = {
			country_event = {
				id = gts_erika.999
			}
			country_event = {
				id = gts_erika.1020
				days = 3650
			}
		}
	}
}

country_event = {
	# 绘里香
	id = gts_erika.999
	title = "gts_erika.1011.name"
	desc = "gts_erika.999.desc"
	show_sound = event_celebration
	is_triggered_only = yes
	picture = GFX_leader_recruitment_bg_renowned
	auto_opens = yes
	event_window_type = leader_recruit
	notification_event_icon = "GFX_message_leader_gts_erika"
	immediate = {
		renowned_gts_leader_creator = {
			LEADER_PORTRAIT = gts_portrait_erika
			CLASS = scientist
			NAME = NAME_gts_erika
			LEVEL = 1
			AGE = 16
			GENDER = female
			ETHIC = authoritarian
			IMMORTAL = yes
			EVENT_LEADER = no
			DESC = DESC_gts_erika
			CATCH_PHRASE = gts_erika_catch_phrase
			RANDOMIZE_TRAITS = no
			TARGET = gts_erika
			TRAIT1 = leader_trait_Titan
		}
	}
	picture_event_data = {
		portrait = event_target:gts_leader
		room = ethic_spaceship_room
	}
	option = {
		name = gts_erika.999.a
		response_text = gts_erika.999.a.response
		is_dialog_only = yes
	}
	option = {
		name = gts_erika.999.b
		response_text = gts_erika.999.b.response
		is_dialog_only = yes
	}
	option = {
		name = gts_erika.999.c
		response_text = gts_erika.999.c.response
		is_dialog_only = yes
	}
	option = {
		name = HIRE
		tag = hire_leader
		custom_tooltip = gts_erika.999.hire_custom_tooltip
		hidden_effect = {
			renowned_gts_leader_hire_effect = yes
		}
	}
	option = {
		name = DISMISS
		tag = dismiss_leader
		hidden_effect = {
			country_event = {
				id = gts_erika.999
			}
		}
	}
	after = {
		random_owned_leader = {
			limit = {
				has_leader_flag = gts_erika
			}
			add_skill_without_trait_selection = 4
		}
	}
}

country_event = {
	# 绘里香招募10年事件
	id = gts_erika.1020
	title = gts_erika.1020.name
	desc = gts_erika.1020.desc
	diplomatic = yes
	custom_gui = "gts_horizontal_event_window"
	custom_gui_option = "gts_horizontal_event_button"
	picture_event_data = {
		room = gts_event_7_room
	}
	show_sound = event_default
	is_triggered_only = yes
	immediate = {
		# 用flag找到繪里香
		every_owned_leader = {
			limit = {
				has_leader_flag = gts_erika
			}
			save_event_target_as = gts_bruh_erika_kill_count
		}
	}
	option = {
		name = gts_erika.1020.a
		random_owned_planet = {
			limit = {
				pop_amount > 1000
			}
			if = {
				# 优先消耗有vore特质的小人
				limit = {
					any_owned_pop_group = {
						pop_group_has_trait = trait_tiny_vore
					}
				}
				while = {
					count = 10
					random_owned_pop_group = {
						limit = {
							pop_group_has_trait = trait_tiny_vore
						}
						kill_single_pop = yes
					}
				}
			}
			else_if = {
				#其次消耗小人
				limit = {
					any_owned_pop_group = {
						gts_is_tiny = yes
					}
				}
				while = {
					count = 10
					random_owned_pop_group = {
						limit = {
							gts_is_tiny = yes
						}
						kill_single_pop = yes
					}
				}
			}
			else = {
				#最后别管大小就是vore
				while = {
					count = 10
					random_owned_pop_group = {
						kill_single_pop = yes
					}
				}
			}
		}
		event_target:gts_bruh_erika_kill_count = {
			change_variable = {
				which = gts_vore_kills_logs
				value = 1000
			}
			add_experience = 10
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier4unityreward
			min = @tier4unitymin
			max = @tier4unitymax
		}
		hidden_effect = {
			country_event = {
				id = gts_erika.1021
				days = 3650
			}
		}
	}
}

country_event = {
	# 绘里香招募20年事件
	id = gts_erika.1021
	title = gts_erika.1021.name
	desc = gts_erika.1021.desc
	diplomatic = yes
	custom_gui = "gts_horizontal_event_window"
	custom_gui_option = "gts_horizontal_event_button"
	picture_event_data = {
		room = gts_event_8_room
	}
	show_sound = event_default
	is_triggered_only = yes
	option = {
		name = gts_erika.1021.a
		add_monthly_resource_mult = {
			resource = unity
			value = @tier4unityreward
			min = @tier4unitymin
			max = @tier4unitymax
		}
	}
}

country_event = {

	# 繪里香登陸事件-1

	id = gts_erika.1030
	title = gts_erika.1030.name
	desc = gts_erika.1030.desc
	diplomatic = yes
	custom_gui = "gts_horizontal_event_window"
	custom_gui_option = "gts_horizontal_event_button"
	picture_event_data = {
		room = gts_event_7_room
	}
	show_sound = event_default
	is_triggered_only = yes

	immediate = {
		every_owned_leader = {
			limit = {
				has_leader_flag = gts_erika
			}
			save_event_target_as = gts_bruh_erika_kill_count
		}
		event_target:gts_attackers_win_planet = {

			# 計算人口數量
			export_trigger_value_to_variable = {
				trigger = pop_amount
				variable = gts_bruh_get_planet_killed_pop_count
			}

			# 計算城市數量
			export_trigger_value_to_variable = {
				trigger = pop_amount
				variable = gts_bruh_get_planet_destroyed_city_count
			}
			divide_variable = {
				which = gts_bruh_get_planet_destroyed_city_count
				value = 100
			}
			round_variable = gts_bruh_get_planet_destroyed_city_count

			# 計算經驗獲取
			export_trigger_value_to_variable = {
				trigger = pop_amount
				variable = gts_bruh_get_experience_count
			}
			divide_variable = {
				which = gts_bruh_get_experience_count
				value = 10
			}
			round_variable = gts_bruh_get_experience_count
		}
	}

	option = {
		name = gts_erika.1030.a
		event_target:gts_bruh_erika_kill_count = {
			change_variable = {
				which = gts_vore_kills_logs
				value = event_target:gts_attackers_win_planet.gts_bruh_get_planet_killed_pop_count
			}
			change_variable = {
				which = gts_city_kills_logs
				value = event_target:gts_attackers_win_planet.gts_bruh_get_planet_destroyed_city_count
			}
			change_variable = {
				which = gts_planet_kills_logs
				value = 1
			}
			hidden_effect = {
				change_variable = {
					which = gts_bruh_get_experience_count
					value = event_target:gts_attackers_win_planet.gts_bruh_get_experience_count
				}
				add_experience = gts_bruh_get_experience_count
			}
		}
		event_target:gts_attackers_win_planet = {
			if = {
				# 把居住站刪了
				limit = {
					is_planet_class = pc_habitat
				}
				destroy_colony = yes
				remove_planet = yes
			}
			else = {
				destroy_colony = yes
				while = {
					count = 3
					add_deposit = d_crater
					add_deposit = d_bomb_crater
					add_deposit = d_city_ruins
				}
			}
		}
	}
}

country_event = {

	# 繪里香登陸事件-2

	id = gts_erika.1031
	title = gts_erika.1031.name
	desc = gts_erika.1031.desc
	diplomatic = yes
	custom_gui = "gts_horizontal_event_window"
	custom_gui_option = "gts_horizontal_event_button"
	picture_event_data = {
		room = gts_event_8_room
	}
	show_sound = event_default
	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = gts_erika.1031.a
	}
}

